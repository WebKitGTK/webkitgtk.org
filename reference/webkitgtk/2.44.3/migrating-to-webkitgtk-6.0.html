<!--
SPDX-FileCopyrightText: The WebKit GTK and WPE teams

SPDX-License-Identifier: BSD, LGPL-2.1
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>WebKit &ndash; 6.0: Migrating WebKitGTK Applications to GTK 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  

  
  <meta property="og:title" content="WebKit: Migrating WebKitGTK Applications to GTK 4"/>
  <meta property="og:description" content="Reference for WebKit-6.0: Migrating WebKitGTK Applications to GTK 4"/>
  <meta name="twitter:title" content="WebKit: Migrating WebKitGTK Applications to GTK 4"/>
  <meta name="twitter:description" content="Reference for WebKit-6.0: Migrating WebKitGTK Applications to GTK 4"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="gtk4-urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">WebKit</a></h3>
        <p>API Version: 6.0</p>
        
        <p>Library Version: 2.44.3</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2023.4</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Migrating WebKitGTK Applications to GTK 4
    <a href="#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <h1 id="migrating-webkitgtk-applications-to-gtk-4">Migrating WebKitGTK Applications to GTK 4<a class="md-anchor" href="#migrating-webkitgtk-applications-to-gtk-4" title="Permanent link"></a></h1>
<p>This document contains guidance to application developers looking to migrate
applications that use WebKitGTK from <span class="caps">GTK</span> 3 to <span class="caps">GTK</span>&nbsp;4.</p>
<p>webkitgtk-6.0 is a new <span class="caps">API</span> version of WebKitGTK designed for use with <span class="caps">GTK</span> 4 and
libsoup 3. This <span class="caps">API</span> version obsoletes webkit2gtk-4.0 and webkit2gtk-4.1, the
<span class="caps">GTK</span> 3 <span class="caps">API</span> versions for libsoup 2 and libsoup 3, respectively. It also obsoletes
webkit2gtk-5.0, which was an earlier unstable <span class="caps">API</span> version for <span class="caps">GTK</span>&nbsp;4.</p>
<h2 id="upgrade-to-libsoup-3">Upgrade to libsoup 3<a class="md-anchor" href="#upgrade-to-libsoup-3" title="Permanent link"></a></h2>
<p>libsoup 2 and libsoup 3 cannot be linked together. If your application currently
uses webkit2gtk-4.0, you must first port to webkit2gtk-4.1 by eliminating use
of libsoup 2. See <a href="https://libsoup.org/libsoup-3.0/migrating-from-libsoup-2.html">Migrating from libsoup 2</a>
for guidance on this. After first migrating to webkit2gtk-4.1, then it is
time to start looking into&nbsp;webkitgtk-6.0.</p>
<h2 id="stop-using-deprecated-apis">Stop Using Deprecated APIs<a class="md-anchor" href="#stop-using-deprecated-apis" title="Permanent link"></a></h2>
<p>All APIs that were previously deprecated in webkit2gtk-4.0 and webkit2gtk-4.1
have been removed. This includes the original JavaScriptCore <span class="caps">API</span> (e.g.
<code>JSContextRef</code> and <code>JSObjectRef</code>), which has been replaced by the GObject-style
JavaScriptCore <span class="caps">API</span> (e.g. <span class="caps">JSC</span>.Context and <span class="caps">JSC</span>.Object) that is
available since 2.22. It also includes the entire GObject <span class="caps">DOM</span> <span class="caps">API</span> (e.g.
<code>WebKitDOMDocument</code>), which has been removed without replacement. Use JavaScript
to interact with and manipulate the <span class="caps">DOM</span> instead, perhaps via
<a href="method.WebView.evaluate_javascript.html"><code>webkit_web_view_evaluate_javascript()</code></a> or
<a href="method.WebView.call_async_javascript_function.html"><code>webkit_web_view_call_async_javascript_function()</code></a> in the <span class="caps">UI</span> process, or
<span class="caps">JSC</span>.ValueObject.invoke_method in the web&nbsp;process.</p>
<p>Run your application with the environment variable <code>G_ENABLE_DIAGNOSTIC=1</code> to
notice use of deprecated signals and&nbsp;properties.</p>
<h2 id="upgrade-to-gtk-4">Upgrade to GTK 4<a class="md-anchor" href="#upgrade-to-gtk-4" title="Permanent link"></a></h2>
<p>After successfully building your webkit2gtk-4.1 application without deprecation
warnings, then it is time to attempt to upgrade to <span class="caps">GTK</span> 4 and webkitgtk-6.0.
This is easier said than done, but <a href="https://docs.gtk.org/gtk4/migrating-3to4.html">the <span class="caps">GTK</span> 4 migration guide</a>
will help. Good&nbsp;luck.</p>
<h2 id="most-types-are-final">Most Types Are Final<a class="md-anchor" href="#most-types-are-final" title="Permanent link"></a></h2>
<p>Only two types are now&nbsp;derivable:</p>
<ul>
<li><a href="class.WebView.html"><code>WebKitWebView</code></a> has been often subclassed to customize its behavior for an
  specific application. This possibility has been kept, as it has proved
  useful in the&nbsp;past.</li>
<li><a href="class.InputMethodContext.html"><code>WebKitInputMethodContext</code></a> is specifically designed in a way that subclassing
  is required to make use of&nbsp;it.</li>
</ul>
<p>The rest of the types are no longer derivable; they are defined with the
<code>G_TYPE_FLAG_FINAL</code> flag set. Use composition instead of&nbsp;derivation.</p>
<h2 id="mandatory-web-process-sandbox">Mandatory Web Process Sandbox<a class="md-anchor" href="#mandatory-web-process-sandbox" title="Permanent link"></a></h2>
<p>The <code>webkit_web_context_set_sandbox_enabled()</code> and <code>webkit_web_context_get_sandbox_enabled()</code>
functions have been removed. The web process sandbox is now always enabled. If
your application&#8217;s web process needs to access extra directories, use
<a href="method.WebContext.add_path_to_sandbox.html"><code>webkit_web_context_add_path_to_sandbox()</code></a> to mount them in the&nbsp;sandbox.</p>
<h2 id="mandatory-process-swap-on-cross-site-navigation">Mandatory Process Swap on Cross-site Navigation<a class="md-anchor" href="#mandatory-process-swap-on-cross-site-navigation" title="Permanent link"></a></h2>
<p>The <code>WebKitWebContext:process-swap-on-cross-site-navigation-enabled</code> property
has been removed. Process swapping is now mandatory. Your application should be
prepared for the web view&#8217;s web process to be replaced when navigating between
different security origins. You can ensure that your application is prepared for
this change before porting to <span class="caps">GTK</span> 4 by testing your application with the
<code>WebKitWebContext:process-swap-on-cross-site-navigation-enabled</code> property
enabled. This property was previously disabled by&nbsp;default.</p>
<h2 id="event-parameter-removed-from-context-menu-and-option-menu-signals">Event Parameter Removed from Context Menu and Option Menu Signals<a class="md-anchor" href="#event-parameter-removed-from-context-menu-and-option-menu-signals" title="Permanent link"></a></h2>
<p><a href="signal.WebView.context-menu.html"><code>WebKitWebView::context-menu</code></a> and <a href="signal.WebView.show-option-menu.html"><code>WebKitWebView::show-option-menu</code></a>
no longer have a <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Event.html" class="external"><code>GdkEvent</code></a> parameter. Adjust your signal handlers&nbsp;accordingly.</p>
<h2 id="changes-to-webkitwebview-construction">Changes to WebKitWebView Construction<a class="md-anchor" href="#changes-to-webkitwebview-construction" title="Permanent link"></a></h2>
<p><code>webkit_web_view_new_with_context()</code>, <code>webkit_web_view_new_with_settings()</code>,
<code>webkit_web_view_new_with_user_content_manager()</code>, and
<code>webkit_web_view_new_with_related_view()</code> have all been removed. You
may directly use <code>g_object_new()</code> instead. <a href="ctor.WebView.new.html"><code>webkit_web_view_new()</code></a>&nbsp;remains.</p>
<h2 id="network-session-api">Network Session API<a class="md-anchor" href="#network-session-api" title="Permanent link"></a></h2>
<p>WebKit now uses a single global network process for all web contexts, and different
network sessions can be created and used in the same network process. All the networking
APIs have been moved from <a href="class.WebContext.html"><code>WebKitWebContext</code></a> and <a href="class.WebsiteDataManager.html"><code>WebKitWebsiteDataManager</code></a> to the new class
<a href="class.NetworkSession.html"><code>WebKitNetworkSession</code></a>. There&#8217;s a default global persistent session that you can get with
<a href="type_func.NetworkSession.get_default.html"><code>webkit_network_session_get_default()</code></a>. You can also create new sessions with
<a href="ctor.NetworkSession.new.html"><code>webkit_network_session_new()</code></a> for persistent sessions and <a href="ctor.NetworkSession.new_ephemeral.html"><code>webkit_network_session_new_ephemeral()</code></a>
for ephemeral sessions. It&#8217;s no longer possible to create a <a href="class.WebsiteDataManager.html"><code>WebKitWebsiteDataManager</code></a>; it&#8217;s now
created by the <a href="class.NetworkSession.html"><code>WebKitNetworkSession</code></a> automatically at construction time. The <a href="class.NetworkSession.html"><code>WebKitNetworkSession</code></a>
to be used must be passed to the <a href="class.WebView.html"><code>WebKitWebView</code></a> as a construct parameter. You can pass the
same <a href="class.NetworkSession.html"><code>WebKitNetworkSession</code></a> object to several web views to use the same session. The only exception
is automation mode, which uses its own ephemeral session that is configured by the automation
session capabilities. If you notice that your application uses <a href="class.WebContext.html"><code>WebKitWebContext</code></a> or
<a href="class.WebsiteDataManager.html"><code>WebKitWebsiteDataManager</code></a> APIs that no longer exist, look for replacement APIs
in <a href="class.NetworkSession.html"><code>WebKitNetworkSession</code></a>.</p>
<p><code>webkit_web_context_clear_cache()</code> does not have a direct replacement, but you
can use <a href="method.WebsiteDataManager.clear.html"><code>webkit_website_data_manager_clear()</code></a> to achieve the same&nbsp;effect.</p>
<p>The <code>WebKitWebContext::download-started</code> signal has been removed. Use
<a href="signal.NetworkSession.download-started.html"><code>WebKitNetworkSession::download-started</code></a>&nbsp;instead.</p>
<h2 id="favicon-database">Favicon Database<a class="md-anchor" href="#favicon-database" title="Permanent link"></a></h2>
<p><a href="class.FaviconDatabase.html"><code>WebKitFaviconDatabase</code></a> is now owned by <a href="class.WebsiteDataManager.html"><code>WebKitWebsiteDataManager</code></a>
instead of <a href="class.WebContext.html"><code>WebKitWebContext</code></a>. Use
<a href="method.WebsiteDataManager.set_favicons_enabled.html"><code>webkit_website_data_manager_set_favicons_enabled()</code></a> to enable the favicon&nbsp;database.</p>
<p>There is no replacement for <code>webkit_web_context_set_favicon_database_directory()</code>.
Favicons will be stored in the base cache directory of the website data&nbsp;manager.</p>
<h2 id="hardware-acceleration-policy">Hardware Acceleration Policy<a class="md-anchor" href="#hardware-acceleration-policy" title="Permanent link"></a></h2>
<p><code>WEBKIT_HARDWARE_ACCELERATION_POLICY_ON_DEMAND</code> has been removed from
<a href="enum.HardwareAccelerationPolicy.html"><code>WebKitHardwareAccelerationPolicy</code></a>. You may still use
<a href="method.Settings.set_hardware_acceleration_policy.html"><code>webkit_settings_set_hardware_acceleration_policy()</code></a> to enable or disable
hardware&nbsp;acceleration.</p>
<h2 id="scrollbar-appearance">Scrollbar Appearance<a class="md-anchor" href="#scrollbar-appearance" title="Permanent link"></a></h2>
<p>Because <span class="caps">GTK</span> 4 does not contain a foreign drawing <span class="caps">API</span>, it is no longer possible
to draw scrollbars that match arbitrary <span class="caps">GTK</span> themes. Accordingly, the
<code>webkit_web_context_get_use_system_appearance_for_scrollbars</code> and
<code>webkit_web_context_set_use_system_appearance_for_scrollbars</code> APIs have been
removed. WebKit will draw scrollbars that match the Adwaita <span class="caps">GTK</span>&nbsp;theme.</p>
<h2 id="user-script-message-handlers">User Script Message Handlers<a class="md-anchor" href="#user-script-message-handlers" title="Permanent link"></a></h2>
<p><code>webkit_user_content_manager_register_script_message_handler_in_world()</code> and
<code>webkit_user_content_manager_unregister_script_message_handler_in_world()</code> have
been removed. Instead, <a href="method.UserContentManager.register_script_message_handler.html"><code>webkit_user_content_manager_register_script_message_handler()</code></a>
and <a href="method.UserContentManager.unregister_script_message_handler.html"><code>webkit_user_content_manager_unregister_script_message_handler()</code></a> have
gained parameters to specify the script world to&nbsp;use.</p>
<h2 id="download-destination">Download Destination<a class="md-anchor" href="#download-destination" title="Permanent link"></a></h2>
<p><a href="method.Download.set_destination.html"><code>webkit_download_set_destination()</code></a>, <a href="method.Download.get_destination.html"><code>webkit_download_get_destination()</code></a>,
<a href="property.Download.destination.html"><code>WebKitDownload:destination</code></a>, and <a href="signal.Download.created-destination.html"><code>WebKitDownload::created-destination</code></a>
now all use a filesystem path rather than a <span class="caps">URI</span>. All uses must be updated&nbsp;accordingly.</p>
<h2 id="javascript-results">JavaScript Results<a class="md-anchor" href="#javascript-results" title="Permanent link"></a></h2>
<p>WebKitJavascriptResult has been removed. <a href="signal.UserContentManager.script-message-received.html"><code>WebKitUserContentManager::script-message-received</code></a>
now directly returns a <span class="caps">JSC</span>.Value&nbsp;instead.</p>
<h2 id="web-process-extension">Web Process Extension<a class="md-anchor" href="#web-process-extension" title="Permanent link"></a></h2>
<p>WebKitWebExtension has been renamed to WebKitWebProcessExtension to avoid
confusion with WebExtensions, which are unrelated. This affects many methods and
signals of other objects as well, e.g. <a href="signal.WebContext.initialize-web-process-extensions.html"><code>WebKitWebContext::initialize-web-process-extensions</code></a>.
The name of your extension&#8217;s entry point must now be <code>webkit_web_process_extension_initialize()</code>
or <code>webkit_web_process_extension_initialize_with_user_data()</code>.</p>
<p>Beware that as of WebKitGTK 2.40, the entire web process <span class="caps">API</span> may unfortunately
be removed in the future. For more information on why, see
<a href="https://lists.webkit.org/pipermail/webkit-dev/2022-August/032329.html">this mailing list thread</a>.</p>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="#upgrade-to-libsoup-3"><span class="link-text">Upgrade to libsoup 3</span></a></li>
        
        <li class="toc-list-item"><a href="#stop-using-deprecated-apis"><span class="link-text">Stop Using Deprecated APIs</span></a></li>
        
        <li class="toc-list-item"><a href="#upgrade-to-gtk-4"><span class="link-text">Upgrade to GTK 4</span></a></li>
        
        <li class="toc-list-item"><a href="#most-types-are-final"><span class="link-text">Most Types Are Final</span></a></li>
        
        <li class="toc-list-item"><a href="#mandatory-web-process-sandbox"><span class="link-text">Mandatory Web Process Sandbox</span></a></li>
        
        <li class="toc-list-item"><a href="#mandatory-process-swap-on-cross-site-navigation"><span class="link-text">Mandatory Process Swap on Cross-site Navigation</span></a></li>
        
        <li class="toc-list-item"><a href="#event-parameter-removed-from-context-menu-and-option-menu-signals"><span class="link-text">Event Parameter Removed from Context Menu and Option Menu Signals</span></a></li>
        
        <li class="toc-list-item"><a href="#changes-to-webkitwebview-construction"><span class="link-text">Changes to WebKitWebView Construction</span></a></li>
        
        <li class="toc-list-item"><a href="#network-session-api"><span class="link-text">Network Session API</span></a></li>
        
        <li class="toc-list-item"><a href="#favicon-database"><span class="link-text">Favicon Database</span></a></li>
        
        <li class="toc-list-item"><a href="#hardware-acceleration-policy"><span class="link-text">Hardware Acceleration Policy</span></a></li>
        
        <li class="toc-list-item"><a href="#scrollbar-appearance"><span class="link-text">Scrollbar Appearance</span></a></li>
        
        <li class="toc-list-item"><a href="#user-script-message-handlers"><span class="link-text">User Script Message Handlers</span></a></li>
        
        <li class="toc-list-item"><a href="#download-destination"><span class="link-text">Download Destination</span></a></li>
        
        <li class="toc-list-item"><a href="#javascript-results"><span class="link-text">JavaScript Results</span></a></li>
        
        <li class="toc-list-item"><a href="#web-process-extension"><span class="link-text">Web Process Extension</span></a></li>
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>